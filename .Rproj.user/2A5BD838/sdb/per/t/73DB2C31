{
    "collab_server" : "",
    "contents" : "## Rentrez tutorial:\n## https://cran.r-project.org/web/packages/rentrez/vignettes/rentrez_tutorial.html\n##\n## Entrez Programming Utilities Help:\n## https://www.ncbi.nlm.nih.gov/books/NBK25499/table/chapter4.T._valid_values_of__retmode_and/\n##\n##\n\nlibrary(rentrez)\n# available DBs\nentrez_dbs()\n\n# Brief description of what the database is\nentrez_db_summary(\"snp\")\n\n# Set of search terms that can used with this database\nentrez_db_searchable(\"snp\")\n\n## Search db: at least need db and term\nentrez_search(db   = \"pubmed\",\n              term = \"(vivax malaria[MeSH]) AND (folic acid antagonists[MeSH])\")\n\n### Adavance counting: count publication\nsearch_year <- function(year, term){\n  query <- paste(term, \"AND (\", year, \"[PDAT])\")\n  entrez_search(db=\"pubmed\", term=query, retmax=0)$count\n}\n\nyear <- 2008:2017\npapers <- sapply(year, search_year, term=\"CAR-T\", USE.NAMES=FALSE)\n\nplot(year, papers, type='b', main=\"The Rise of the CAR-T\")\n\n\n### Finding cross-references : entrez_link()\nall_the_links <- entrez_link(dbfrom='gene', id=351, db='all')\nall_the_links\nall_the_links$links  # format: [source_database]_[linked_database]\n\nall_the_links$links$gene_pmc[1:10]\n\nall_the_links$links$gene_clinvar\nall_cv <- entrez_summary(db=\"clinvar\", id=all_the_links$links$gene_clinvar)\nall_cv\nextract_from_esummary(all_cv, \"gene_sort\")\n\n### \n# clinvar example\nres <- entrez_search(db = \"clinvar\", term = \"leukemia\", retmax=10)\ncv <- entrez_summary(db=\"clinvar\", id=res$ids)\ncv\nextract_from_esummary(cv, \"title\", simplify=FALSE)\nextract_from_esummary(cv, \"trait_set\")[1:2]\nextract_from_esummary(cv, \"gene_sort\")\n\n## Fetching full records: entrez_fetch()\n# Fetch DNA sequences in fasta format\ngene_ids <- c(351, 11647)\nlinked_seq_ids <- entrez_link(dbfrom=\"gene\", id=gene_ids, db=\"nuccore\")\nlinked_transripts <- linked_seq_ids$links$gene_nuccore_refseqrna\nhead(linked_transripts)\nall_recs <- entrez_fetch(db=\"nuccore\", id=linked_transripts, rettype=\"fasta\")\nclass(all_recs)\nnchar(all_recs)\ncat(strwrap(substr(all_recs, 1, 500)), sep=\"\\n\")\n\nwrite(all_recs, file=\"my_transcripts.fasta\")\n# Alternatively writing:\ntemp <- tempfile()\nwrite(all_recs, temp)\nparsed_recs <- ape::read.dna(all_recs, temp)\n\n## Fetch a parsed XML document\nTt <- entrez_search(db=\"taxonomy\", term=\"(Tetrahymena thermophila[ORGN]) AND Species[RANK]\")\ntax_rec <- entrez_fetch(db=\"taxonomy\", id=Tt$ids, rettype=\"xml\", parsed=TRUE)\nclass(tax_rec)\ntax_list <- XML::xmlToList(tax_rec)\ntax_list$Taxon$GeneticCode\n\ntt_lineage <- tax_rec[\"//LineageEx/Taxon/ScientificName\"]\ntt_lineage[1:4]\n\nXML::xpathSApply(tax_rec, \"//LineageEx/Taxon/ScientificName\", XML::xmlValue)\n\n\n#############\n# IL10 and IL10RB snps\nfor(ind in seq(from=1, to=10000, by=50 )){\n  SnpList <- entrez_search(db   = \"snp\",\n                           term = \"(IL10[GENE]) AND (human[ORGN])\", retstart = ind, retmax = 50)\n  #length(SnpList$ids)\n  ids <- SnpList$ids\n  pop_summ <- entrez_summary(db=\"snp\", id=ids)\n  \n  MAF = extract_from_esummary(pop_summ, \"global_maf\")\n  if(length(which(MAF != \"\"))){\n    idx = which(MAF != \"\")\n    print(MAF[idx])\n  }\n}\n\n# \n# esummary result with 46 items:\n# [1] uid                   snp_id                organism              allele_origin        \n# [5] global_maf            global_population     global_samplesize     suspected            \n# [9] clinical_significance genes                 acc                   chr                  \n# [13] weight                handle                fxn_class             validated            \n# [17] gtype                 nonref                docsum                het                  \n# [21] srate                 tax_id                chrrpt                orig_build           \n# [25] upd_build             createdate            updatedate            pop_class            \n# [29] method_class          snp3d                 linkout               ss                   \n# [33] locsnpid              allele                snp_class             chrpos               \n# [37] contigpos             text                  lookup                sort_priority        \n# [41] snp_id_sort           clinical_sort         human_sort            cited_sort           \n# [45] weight_sort           chrpos_sort   \n\n# > pop_summ$`3021093`$chr\n# [1] \"1\"\n# > pop_summ$`3021093`$snp3d\n# [1] \"\"\n# > pop_summ$`3021093`$snp_class\n# [1] \"snp\"\n# > pop_summ$`3021093`$snp_id_sort\n# [1] \"0003021093\"\n# > pop_summ$`3021093`$snp_id\n# [1] 3021093\n# > pop_summ$`3021093`$genes\n# name gene_id\n# 1 IL10    3586\n# > pop_summ$`1800896`$global_maf\n# [1] \"C=0.2722/1363\"\n# > pop_summ$`1800896`$suspected\n# [1] \"\"\n# > pop_summ$`1800896`$ss\n# [1] 276190046\n# > pop_summ$`1800896`$lookup\n# [1] \"2216332910\"\n# > pop_summ$`1800896`$validated\n# [1] \"by-1000G,by-2hit-2allele,by-cluster,by-frequency,by-hapmap\"\n# > pop_summ$`1800896`$chrpos\n# [1] \"1:206773552\"\n# > pop_summ$`1800896`$docsum\n# [1] \"HGVS=NC_000001.10:g.206946897T&gt;C,NC_000001.11:g.206773552T&gt;C,NG_012088.1:g.3943A&gt;G,NM_000572.2:c.-1117A&gt;G|SEQ=CAACACTACTAAGGCTTCTTTGGGA[A/G]GGGGAAGTAGGGATAGGTAAGAGGA|GENE=IL10:3586\"",
    "created" : 1507846732644.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1095925888",
    "id" : "73DB2C31",
    "lastKnownWriteTime" : 1507847329,
    "last_content_update" : 1507847329252,
    "path" : "~/Documents/NGSProject/2017WGS/R/GeneGeneInteraction_HSCT/Rentrez_examples.R",
    "project_path" : "Rentrez_examples.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}